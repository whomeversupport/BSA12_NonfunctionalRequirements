# 🛡️ Exercise 04 — Атрибуты доступности и надежности

<!--
Student: @https://edu.21-school.ru/profile/lunchlpr
Location: SKD SAMARKAND  
GitHub: https://github.com/wh0mever
![Levi Ackerman](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fc.tenor.com%2FHGPFeIo8looAAAAC%2Flevi-ackerman.gif&f=1&nofb=1&ipt=740d7fa033496bb69c29f0fdb0f6d2c01c9e8f9d2d092c25b0c1a31079cb9c3f)
-->

## 📋 Задание

**Указать атрибуты доступности и надежности для каждой задачи с конкретными SLA и стратегиями восстановления.**

## 🏗️ Архитектура отказоустойчивости

### 📊 ASCII схема отказоустойчивости

```
🎯 АРХИТЕКТУРА ОТКАЗОУСТОЙЧИВОСТИ
══════════════════════════════════════════════════════════════════════════

🏪 БАРБЕРШОП - УМЕРЕННАЯ ОТКАЗОУСТОЙЧИВОСТЬ
═══════════════════════════════════════════════
┌─────────────────────────────────────────────────────────────────┐
│                     ПРОСТАЯ АРХИТЕКТУРА                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐          │
│  │ WEB-СЕРВЕР  │───▶│ ОСНОВНАЯ БД │───▶│ РЕЗЕРВНАЯ БД│          │
│  │             │    │             │    │             │          │
│  │ • Nginx     │    │ PostgreSQL  │    │ Backup DB   │          │
│  │ • Node.js   │    │ • Users     │    │ • Daily     │          │
│  │ • Static    │    │ • Bookings  │    │ • Weekly    │          │
│  └─────────────┘    └─────────────┘    └─────────────┘          │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐          │
│  │NOTIFICATIONS│    │   STORAGE   │    │  MONITORING │          │
│  │ • SMS       │    │ • Files     │    │ • Alerts    │          │
│  │ • Email     │    │ • Images    │    │ • Logs      │          │
│  └─────────────┘    └─────────────┘    └─────────────┘          │
└─────────────────────────────────────────────────────────────────┘

📦 ДОСТАВКА - ВЫСОКАЯ ОТКАЗОУСТОЙЧИВОСТЬ  
═══════════════════════════════════════════
┌─────────────────────────────────────────────────────────────────┐
│                   РАСПРЕДЕЛЕННАЯ АРХИТЕКТУРА                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│       ┌─────────────┐          ┌─────────────┐                  │
│       │LOAD BALANCER│─────────▶│LOAD BALANCER│                  │
│       │ Primary     │          │ Secondary   │                  │
│       └─────┬───────┘          └─────┬───────┘                  │
│             │                        │                         │
│   ┌─────────┼────────────────────────┼─────────┐               │
│   │         ▼                        ▼         │               │
│   │  ┌─────────────┐          ┌─────────────┐  │               │
│   │  │APP SERVER 1 │          │APP SERVER 2 │  │               │
│   │  │             │          │             │  │               │
│   │  └─────┬───────┘          └─────┬───────┘  │               │
│   │        │                        │          │               │
│   │        └────────┬───────────────┘          │               │
│   │                 ▼                          │               │
│   │         ┌─────────────┐                    │               │
│   │         │ PRIMARY DB  │◄───────────────────┤               │
│   │         │             │                    │               │
│   │         │ • Orders    │                    │               │
│   │         │ • Tracking  │                    │               │
│   │         │ • Users     │                    │               │
│   │         └─────┬───────┘                    │               │
│   │               │                            │               │
│   │               ▼                            │               │
│   │         ┌─────────────┐                    │               │
│   │         │ STANDBY DB  │                    │               │
│   │         │ Hot Backup  │                    │               │
│   │         └─────────────┘                    │               │
│   └─────────────────────────────────────────────────────────────┘
│                                                                 │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│   │REAL-TIME    │    │  MONITORING │    │   ALERTING  │        │
│   │SYNC         │    │ • Grafana   │    │ • PagerDuty │        │
│   │ • WebSocket │    │ • Prometheus│    │ • SMS       │        │
│   └─────────────┘    └─────────────┘    └─────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

### 🧠 D2 схема архитектуры (современная визуализация)

```d2
# Сравнение архитектур отказоустойчивости
fault_tolerance: Отказоустойчивость {
  shape: hexagon
  style.fill: "#F8F9FA"
}

barbershop_arch: 🏪 Барбершоп {
  style.fill: "#FFEBEE"
  
  simple: Простая архитектура
  
  components: Компоненты {
    web: "Web-сервер (Node.js)"
    primary_db: "Основная БД (PostgreSQL)"
    backup_db: "Резервная БД (Daily)"
    notifications: "Уведомления (SMS/Email)"
  }
  
  characteristics: Характеристики {
    availability: "Доступность: 99.5%"
    recovery: "Восстановление: ≤30 мин"
    monitoring: "Мониторинг: Базовый"
  }
}

delivery_arch: 📦 Доставка {
  style.fill: "#E8F5E8"
  
  distributed: Распределенная архитектура
  
  components: Компоненты {
    lb_primary: "Load Balancer Primary"
    lb_secondary: "Load Balancer Secondary"
    app1: "App Server 1"
    app2: "App Server 2"
    primary_db: "Primary DB"
    standby_db: "Standby DB (Hot)"
    realtime: "Real-time Sync"
  }
  
  characteristics: Характеристики {
    availability: "Доступность: 99.9%"
    recovery: "Восстановление: ≤10 мин"
    monitoring: "Мониторинг: Real-time"
  }
}

fault_tolerance -> barbershop_arch
fault_tolerance -> delivery_arch
```

## 📊 Сравнительная таблица SLA

| Метрика | 🏪 Барбершоп | 📦 Доставка | Обоснование |
|---------|---------------|-------------|-------------|
| **📡 Доступность (рабочее время)** | 99.5% | 99.9% | B2C: гибкость vs B2B: критичность |
| **📡 Доступность (нерабочее время)** | 95% | 99.9% | Барбершоп: техобслуживание OK |
| **🛡️ MTTR (время восстановления)** | ≤ 30 мин | ≤ 10 мин | B2B требует быстрого восстановления |
| **💾 RPO (потеря данных)** | ≤ 15 мин | ≤ 5 мин | Доставка: финансовые последствия |
| **🔄 RTO (время до полного восстановления)** | ≤ 60 мин | ≤ 20 мин | Операционные требования |

## 🎯 Детальные атрибуты доступности

### 🏪 Барбершоп - B2C Доступность

#### 📈 График доступности

```
ГРАФИК ДОСТУПНОСТИ БАРБЕРШОП
═══════════════════════════════════════════════════════════════════

ПОНЕДЕЛЬНИК - ПЯТНИЦА:
────────────────────────────────────────────────────────────────
00:00 ■■■■ Техобслуживание (02:00-04:00)
06:00 ████████████████████████████████████████ Работа (99.5%)
22:00 ■■■■ Пониженная доступность

ВЫХОДНЫЕ:
────────────────────────────────────────────────────────────────
00:00 ■■■■ Техобслуживание (03:00-05:00)  
06:00 ████████████████████████████████████████ Работа (99.5%)
21:00 ■■■■ Пониженная доступность

Легенда:
████ Полная доступность (99.5%)
■■■■ Техобслуживание/пониженная доступность
```

#### 📈 SLA требования:
| Период | Доступность | Простой в месяц | Критичность |
|--------|-------------|-----------------|-------------|
| **Рабочие часы (9:00-21:00)** | 99.5% | ≤ 3.6 часов | 🔴 Критично |
| **Внерабочие часы** | 95% | ≤ 36 часов | 🟡 Умеренно |
| **Техобслуживание** | Запланированное 2-4 AM | 4 часа/неделя | 🟢 Приемлемо |

#### 🔧 Стратегии обеспечения доступности:
- **Мониторинг**: Каждые 5 минут
- **Автоматический перезапуск**: При критических ошибках  
- **Резервирование**: Еженедельные backup'ы
- **Уведомления**: SMS менеджерам при простое > 15 мин

### 📦 Доставка - B2B Доступность

#### 📈 График доступности 24/7

```
ГРАФИК ДОСТУПНОСТИ ДОСТАВКА (24/7)
═══════════════════════════════════════════════════════════════════

24/7 НЕПРЕРЫВНАЯ РАБОТА:
────────────────────────────────────────────────────────────────
00:00 ████████████████████████████████████████████████████ (99.9%)
      ▲ Техобслуживание без простоя (Rolling Updates)
12:00 ████████████████████████████████████████████████████ (99.95%)
      ▲ Пиковые часы - повышенные требования
24:00 ████████████████████████████████████████████████████ (99.9%)

Особенности:
• Техобслуживание без остановки системы
• Пиковые часы: 11:30-14:30, 18:00-21:00
• Автоматическое переключение на резерв
```

#### 📈 SLA требования:
| Период | Доступность | Простой в месяц | Критичность |
|--------|-------------|-----------------|-------------|
| **24/7 операции** | 99.9% | ≤ 43 минуты | 🔴 Критично |
| **Пиковые часы (11:30-14:30, 18:00-21:00)** | 99.95% | ≤ 22 минуты | 🔴 Критично |
| **Техобслуживание** | Rolling updates | 0 минут простоя | 🔴 Критично |

#### 🔧 Стратегии обеспечения доступности:
- **Мониторинг**: Real-time (каждые 30 сек)
- **Load Balancing**: Автоматическое переключение
- **Hot Standby**: Мгновенное переключение на резерв
- **Geographical redundancy**: Резерв в другом ЦОД

## 🛡️ Атрибуты надежности

### 🔄 Стратегии восстановления

#### 🏪 Барбершоп - Процедура восстановления

```
ПРОЦЕДУРА ВОССТАНОВЛЕНИЯ БАРБЕРШОП
═══════════════════════════════════════════════════════════════════

🔍 ЭТАП 1: ОБНАРУЖЕНИЕ (≤ 5 минут)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Автоматический мониторинг системы                        │
│ • Проверка доступности каждые 5 минут                     │
│ • Алерты при недоступности > 2 минут                       │
│ • Проверка основных функций (авторизация, запись)          │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
📱 ЭТАП 2: УВЕДОМЛЕНИЕ (≤ 2 минуты)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • SMS технической поддержке                                │
│ • Email администратору системы                             │
│ • Уведомление в Slack канал                                │
│ • Запись в лог системы                                     │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
🔧 ЭТАП 3: ВОССТАНОВЛЕНИЕ (≤ 30 минут)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Диагностика причины сбоя                                 │
│ • Перезапуск сервисов                                      │
│ • Восстановление из backup при необходимости               │
│ • Проверка целостности данных                              │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
✅ ЭТАП 4: ПРОВЕРКА (≤ 10 минут)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Полная проверка всех функций                             │
│ • Тестирование пользовательских сценариев                  │
│ • Уведомление о восстановлении работы                      │
│ • Анализ причин сбоя для предотвращения                    │
└─────────────────────────────────────────────────────────────┘

ОБЩЕЕ ВРЕМЯ ВОССТАНОВЛЕНИЯ: ≤ 47 минут
```

#### 📦 Доставка - Автоматизированное восстановление

```
АВТОМАТИЗИРОВАННОЕ ВОССТАНОВЛЕНИЕ ДОСТАВКА
═══════════════════════════════════════════════════════════════════

🔍 ЭТАП 1: ОБНАРУЖЕНИЕ (≤ 1 минута)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Real-time мониторинг каждые 30 секунд                   │
│ • Health checks микросервисов                              │
│ • Мониторинг метрик производительности                     │
│ • Автоматические алерты при anomaly detection              │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
🤖 ЭТАП 2: АВТОВОССТАНОВЛЕНИЕ (≤ 2 минуты)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Circuit breaker активация                               │
│ • Автоматическое переключение на standby                   │
│ • Горизонтальное масштабирование при перегрузке           │
│ • Restart failed микросервисов                            │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
👨‍💻 ЭТАП 3: РУЧНОЕ ВМЕШАТЕЛЬСТВО (≤ 10 минут)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Escalation к DevOps команде                             │
│ • Глубокая диагностика проблемы                           │
│ • Восстановление данных при необходимости                 │
│ • Rollback к предыдущей версии                            │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
✅ ЭТАП 4: ПРОВЕРКА (≤ 3 минуты)
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Automated testing suite                                 │
│ • Проверка интеграций с внешними системами                │
│ • Валидация данных и транзакций                           │
│ • Post-incident analysis                                  │
└─────────────────────────────────────────────────────────────┘

ОБЩЕЕ ВРЕМЯ ВОССТАНОВЛЕНИЯ: ≤ 16 минут
```

### 📊 Детальные метрики надежности

#### 🏪 Барбершоп
| Метрика | Целевое значение | Измерение | Действия при нарушении |
|---------|------------------|-----------|------------------------|
| **MTBF** (Среднее время между сбоями) | ≥ 720 часов (30 дней) | Автоматический мониторинг | Анализ причин, улучшение кода |
| **MTTR** (Время восстановления) | ≤ 30 минут | От обнаружения до восстановления | Оптимизация процедур |
| **MTTD** (Время обнаружения) | ≤ 5 минут | Система мониторинга | Улучшение алертов |
| **Успешность backup** | 100% | Еженедельная проверка | Уведомление администратора |

#### 📦 Доставка  
| Метрика | Целевое значение | Измерение | Действия при нарушении |
|---------|------------------|-----------|------------------------|
| **MTBF** (Среднее время между сбоями) | ≥ 2160 часов (90 дней) | Автоматический мониторинг | Критический анализ |
| **MTTR** (Время восстановления) | ≤ 10 минут | Автоматизированное восстановление | Escalation к DevOps |
| **MTTD** (Время обнаружения) | ≤ 1 минута | Real-time мониторинг | Немедленный алерт |
| **Успешность синхронизации** | 99.99% | Continuous monitoring | Автоматическое восстановление |

## 💾 Стратегии резервного копирования

### 🏪 Барбершоп - Backup стратегия

#### 📅 График резервного копирования

```
ГРАФИК РЕЗЕРВНОГО КОПИРОВАНИЯ БАРБЕРШОП
═══════════════════════════════════════════════════════════════════

📅 ЕЖЕДНЕВНО (23:00):
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Инкрементальный backup БД                                │
│ • Сохранение изменений за день                             │
│ • Копирование пользовательских файлов                      │
│ • Retention: 7 дней                                        │
│ • Локальное хранилище                                      │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
📅 ЕЖЕНЕДЕЛЬНО (Воскресенье, 01:00):
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Полный backup всей системы                               │
│ • Все базы данных + файлы + конфигурация                   │
│ • Retention: 4 недели                                      │
│ • Облачное хранилище (AWS S3)                             │
│ • Проверка целостности backup'а                           │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
📅 ЕЖЕМЕСЯЧНО (1-е число, 02:00):
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Архивный backup для долгосрочного хранения               │
│ • Сжатие и шифрование данных                               │
│ • Retention: 3 года (требования законодательства)          │
│ • Офлайн хранилище + географически удаленный ЦОД          │
│ • Тестирование восстановления                              │
└─────────────────────────────────────────────────────────────┘

STORAGE STRATEGY:
═══════════════════════════════════════════════════════════════════
Local Storage    ───► Daily backups (7 дней)
Cloud Storage    ───► Weekly backups (4 недели)  
Archive Storage  ───► Monthly backups (3 года)
```

### 📦 Доставка - Enterprise Backup

#### 🔄 Continuous Backup Strategy

```
CONTINUOUS BACKUP СТРАТЕГИЯ ДОСТАВКА
═══════════════════════════════════════════════════════════════════

⚡ REAL-TIME REPLICATION:
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Synchronous replication к hot standby                    │
│ • RPO: < 5 минут                                           │
│ • Автоматическое failover при сбое primary                 │
│ • Binary log replication (MySQL/PostgreSQL)               │
│ • Мониторинг lag'а репликации                             │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
📅 HOURLY SNAPSHOTS:
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Снапшоты системы каждый час                              │
│ • Point-in-time recovery возможность                       │
│ • Retention: 48 часов                                      │
│ • SSD storage для быстрого восстановления                  │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
📅 DAILY FULL BACKUP:
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Полный backup всех микросервисов                         │
│ • Включая конфигурации Kubernetes                          │
│ • Retention: 30 дней                                       │
│ • Distributed storage across multiple zones               │
│ • Шифрование AES-256                                       │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
🗄️ COMPLIANCE ARCHIVING:
────────────────────────────────────────────────────────────────
┌─────────────────────────────────────────────────────────────┐
│ • Ежемесячные архивы для соответствия требованиям          │
│ • Retention: 7 лет (финансовые данные)                     │
│ • Immutable storage (WORM - Write Once, Read Many)        │
│ • Geographic distribution                                  │
│ • Legal hold capabilities                                  │
└─────────────────────────────────────────────────────────────┘

DISASTER RECOVERY MATRIX:
═══════════════════════════════════════════════════════════════════
Scenario          │ RTO      │ RPO      │ Method
──────────────────┼──────────┼──────────┼─────────────────────────
Node failure      │ 2 min    │ 0 min    │ Auto failover
Zone failure      │ 10 min   │ 5 min    │ Regional backup
Region failure    │ 60 min   │ 15 min   │ Cross-region restore
Catastrophic      │ 4 hours  │ 1 hour   │ Full rebuild
```

## 🏆 Практические рекомендации

### ✅ Барбершоп - Reliability Best Practices

```
ПЛАН ПОВЫШЕНИЯ НАДЕЖНОСТИ БАРБЕРШОП
═══════════════════════════════════════════════════════════════════

Phase 1: Базовая надежность (2-4 недели)
────────────────────────────────────────────────────────────────
• Настройка автоматических backup'ов
• Базовый мониторинг доступности  
• Простые процедуры восстановления
• Health checks основных сервисов

Phase 2: Улучшенная доступность (1-2 месяца)
────────────────────────────────────────────────────────────────
• Hot standby база данных
• Load balancer для отказоустойчивости
• Автоматические алерты и escalation
• Документированные runbook'и

Phase 3: Операционная зрелость (3-6 месяцев)
────────────────────────────────────────────────────────────────
• Chaos engineering для тестирования
• Advanced monitoring и observability
• Автоматизированное восстановление
• Regular disaster recovery drills
```

### ⚡ Доставка - Enterprise Reliability

```
ПЛАН ENTERPRISE НАДЕЖНОСТИ ДОСТАВКА
═══════════════════════════════════════════════════════════════════

Phase 1: Микросервисная отказоустойчивость (1-2 месяца)
────────────────────────────────────────────────────────────────
• Circuit breakers во всех сервисах
• Health checks и liveness probes
• Distributed tracing для диагностики
• Graceful degradation patterns

Phase 2: Географическая отказоустойчивость (2-4 месяца)
────────────────────────────────────────────────────────────────
• Multi-region deployment
• Cross-region data replication
• Global load balancing
• Disaster recovery automation

Phase 3: Extreme reliability (6+ месяцев)
────────────────────────────────────────────────────────────────
• Chaos engineering в production
• Self-healing infrastructure
• Predictive failure detection
• Zero-downtime deployments
```

<!-- Hidden autograph -->
<!-- 
Student: @https://edu.21-school.ru/profile/lunchlpr
Location: SKD SAMARKAND  
GitHub: https://github.com/wh0mever
Fun: ⚔️ "Trust is earned through reliability" - Levi building unbreakable systems! 🛡️
--> 
